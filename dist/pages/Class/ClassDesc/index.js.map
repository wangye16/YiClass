{"version":3,"file":"pages/Class/ClassDesc/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;ACtJA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AACA;AAIA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;AChGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAGA;AAIA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;ACvDA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAGA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;;;;;;;;;;;;;AChDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;ACRA;AACA;AACA;AACA;AAEA;AACA;AACA","sources":["webpack://YiClass/./src/pages/Class/ClassDesc/index.tsx?f223","webpack://YiClass/._src_pages_Class_ClassDesc_components_PaymentStatusBar_index.tsx","webpack://YiClass/._src_pages_Class_ClassDesc_components_SessionList_index.tsx","webpack://YiClass/._src_pages_Class_ClassDesc_components_VideoComp_index.tsx","webpack://YiClass/._src_pages_Class_ClassDesc_index.tsx","webpack://YiClass/._src_services_pay.ts"],"sourcesContent":["import { View, Text, Image, ScrollView } from \"@tarojs/components\";\nimport { useRouter, useReady, useUnload } from \"@tarojs/taro\";\nimport { getClassDescAPI, postSessionProgress } from \"@/services/class\";\nimport studentImg from \"@/assets/icons/student.png\";\nimport CustomVideo from \"./components/VideoComp\";\nimport SessionList from \"./components/SessionList\";\nimport PaymentStatusBar from \"./components/PaymentStatusBar\";\nimport { defaultImg } from \"@/assets/const\";\nimport \"./index.less\";\nimport { useEffect, useState } from \"react\";\nimport Taro from \"@tarojs/taro\";\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function Index() {\n  const {\n    params: urlParams\n  } = useRouter();\n  const {\n    classId,\n    studyCount\n  } = urlParams;\n  const [classDesc, setClassDesc] = useState({});\n  const [curSessionObj, setCurSessionObj] = useState({});\n  useReady(() => {\n    getClassDesc();\n  });\n  useUnload(() => {\n    // Âç∏ËΩΩÈ°µÈù¢Êó∂‰∏ä‰º†ÊâÄÊúâÁ´†ËäÇÁöÑËøõÂ∫¶ÔºåÁÑ∂ÂêéÊ∏ÖÈô§ÁºìÂ≠ò\n    const progressArr = classDesc?.context?.map(item => {\n      let obj = {\n        sessionId: item.sessionId,\n        classId,\n        progress: Taro.getStorageSync(item.sessionId + '')\n      };\n      if (item.sessionId == Taro.getStorageSync('curLearningSession')) {\n        obj.isLearning = true;\n      }\n      return obj;\n    });\n    postSessionProgress(progressArr);\n    console.log('ËßÜÈ¢ëÈ°µÈù¢Â∑≤ÁªèÂç∏ËΩΩÔºåÁºìÂ≠òÊòØÔºö', Taro.getStorageInfoSync());\n    classDesc?.context?.map(item => {\n      console.log('a', item.sessionId);\n      Taro.removeStorageSync(item.sessionId);\n    });\n\n    // Âà†Èô§curLearningSessionÂ≠óÊÆµ\n    Taro.removeStorageSync('curLearningSession');\n    console.log('ËßÜÈ¢ëÈ°µÈù¢Â∑≤ÁªèÂç∏ËΩΩÔºåÊ∏ÖÈô§ÂêéÁºìÂ≠òÊòØÔºö', Taro.getStorageInfoSync());\n  });\n  const setProgressStorage = sessionList => {\n    console.log(\"üöÄ ~ setProgressStorage ~ sessionList:\", sessionList);\n    sessionList?.map(item => {\n      Taro.setStorageSync(item.sessionId + '', item.progress);\n    });\n  };\n  const getClassDesc = async () => {\n    try {\n      const response = await getClassDescAPI(classId || '');\n      const {\n        code,\n        data = {}\n      } = response.data;\n      // ÊääËßÜÈ¢ëËøõÂ∫¶ÊîæÂú®Êú¨Âú∞Â≠òÂÇ®\n      setProgressStorage(data.context || []);\n      setClassDesc(data);\n    } catch (error) {\n      Taro.showToast({\n        title: \"ËØ∑Ê±ÇÂ§±Ë¥•\",\n        icon: \"error\",\n        duration: 2000\n      });\n      console.log(\"Error sending chat message:\", error);\n    }\n  };\n  useEffect(() => {\n    const learningSessionObj = classDesc?.context?.find(i => i.sessionId == classDesc.learningSession) || {};\n    setCurSessionObj(learningSessionObj);\n  }, [classDesc.learningSession]);\n  return /*#__PURE__*/_jsxs(View, {\n    className: \"class-container\",\n    children: [/*#__PURE__*/_jsx(View, {\n      className: \"class-video-container\",\n      children: classDesc?.paymentStatus == 'notPaid' ? /*#__PURE__*/_jsx(Image, {\n        src: classDesc?.coverImage || defaultImg,\n        lazyLoad: true,\n        style: {\n          width: \"100%\",\n          height: \"100%\",\n          background: \"#fff\",\n          objectFit: \"contain\"\n        }\n      }) : /*#__PURE__*/_jsx(CustomVideo, {\n        desc: classDesc,\n        curSessionObj: curSessionObj,\n        sessionId: curSessionObj.sessionId || classDesc.learningSession\n      }, curSessionObj.sessionId)\n    }), /*#__PURE__*/_jsxs(View, {\n      className: \"class-desc-container\",\n      children: [/*#__PURE__*/_jsx(Text, {\n        className: \"class-name-text\",\n        children: classDesc?.className\n      }), /*#__PURE__*/_jsxs(View, {\n        style: {\n          fontSize: 12,\n          lineHeight: \"18px\",\n          color: \"#4B5563\",\n          marginTop: 6\n        },\n        children: [/*#__PURE__*/_jsx(Image, {\n          src: studentImg,\n          style: {\n            width: 14,\n            height: 14,\n            marginRight: 3,\n            verticalAlign: \"middle\"\n          }\n        }), /*#__PURE__*/_jsxs(Text, {\n          style: {\n            verticalAlign: \"middle\"\n          },\n          children: [studyCount, \"\\u4EBA\\u5B66\\u4E60\"]\n        })]\n      }), /*#__PURE__*/_jsxs(View, {\n        className: \"class-desc-text\",\n        children: [/*#__PURE__*/_jsx(Text, {\n          style: {\n            lineHeight: \"21px\",\n            color: \"#000\"\n          },\n          children: \"\\u8BFE\\u7A0B\\u7B80\\u4ECB\"\n        }), /*#__PURE__*/_jsx(ScrollView, {\n          scrollY: true,\n          style: {\n            height: 120,\n            marginTop: 6,\n            color: \"#4B5563\",\n            fontSize: 12,\n            lineHeight: \"19px\"\n          },\n          children: classDesc.description\n        })]\n      }), /*#__PURE__*/_jsx(SessionList, {\n        curSessionId: curSessionObj.sessionId,\n        classDesc: classDesc,\n        setCurSessionObj: setCurSessionObj\n      })]\n    }), /*#__PURE__*/_jsx(PaymentStatusBar, {\n      classDesc: classDesc\n    })]\n  });\n}","import { View, Button, Text } from \"@tarojs/components\";\r\nimport \"./index.less\";\r\nimport { useState } from \"react\";\r\nimport Taro from \"@tarojs/taro\";\r\nimport {pay,getPayRes} from '@/services/pay'\r\nexport default function Index({ classDesc }) {\r\n  const { paymentStatus, price ,classId,className,} = classDesc;\r\n  const [payButtonLoading, setPayButtonLoading] = useState<boolean>(false);\r\n  const orderId = `fsdyt_${classId}${Date.now()}`\r\n\r\n  const onPayTap=async ()=>{\r\n    setPayButtonLoading(true)\r\n    const paymentParams = await pay({\r\n      openid:Taro.getStorageSync('openid'),\r\n      orderNumber:orderId,\r\n      totalFee:2, // ÂæÆ‰ø°ÊîØ‰ªòÈáëÈ¢ùÁöÑÂçï‰ΩçÊòØÂàÜÔºåÊâÄ‰ª•ÈúÄË¶Å‰πò‰ª•100\r\n      description:`ËØæÁ®ã„Ää${className}„ÄãÁöÑÊîØ‰ªòËÆ¢Âçï`,\r\n      courseId:classId,\r\n    });\r\n    console.log(\"üöÄ ~ onPayTap ~ paymentParams:\", paymentParams)\r\n    Taro.requestPayment({\r\n      timeStamp: paymentParams.data.timeStamp,\r\n      nonceStr: paymentParams.data.nonceStr,\r\n      package: paymentParams.data.package,\r\n      signType: paymentParams.data.signType,\r\n      paySign: paymentParams.data.paySign,\r\n      success(res) {\r\n        console.log(\"ÊîØ‰ªòÊàêÂäü:\", res);\r\n          getPayRes(orderId).then(res=>{\r\n            console.log('hahah',res.data);\r\n            if (res.data?.code != 200) {\r\n              Taro.showToast({\r\n                title:'ËÆ¢ÂçïÂºÇÂ∏∏ÔºåËØ∑ËÅîÁ≥ªÂÆ¢Êúç',\r\n                icon:'error',\r\n                duration:4000,\r\n              })\r\n            }else{\r\n              Taro.redirectTo({\r\n                url:`/pages/PayResult/index?courseId=${res.data?.data?.courseId}&totalFee=${res.data?.data?.totalFee}`\r\n              })\r\n            }\r\n          }).catch(err=>{\r\n            Taro.showToast({\r\n              title:'ËÆ¢ÂçïÂºÇÂ∏∏ÔºåËØ∑ËÅîÁ≥ªÂÆ¢Êúç',\r\n              icon:'error',\r\n              duration:4000,\r\n            })\r\n          })\r\n      },\r\n      fail(err) {\r\n        console.error(\"ÊîØ‰ªòÂ§±Ë¥•:\", err);\r\n        Taro.showToast({\r\n          title:'ÊîØ‰ªòÂ§±Ë¥•',\r\n          icon:'error',\r\n          duration:2000,\r\n        })\r\n      },\r\n    });\r\n    setPayButtonLoading(false)\r\n  }\r\n\r\n  // Â∫ïÈÉ®ÊîØ‰ªòÁä∂ÊÄÅ‰ø°ÊÅØÁöÑÊ∏≤ÊüìÂáΩÊï∞\r\n  const renderPaymentStatusView = () => {\r\n    switch (paymentStatus) {\r\n      case \"notPaid\":\r\n        return (\r\n          <View className=\"bottom-info\">\r\n            <View style={{ margin: 15 ,height:42,lineHeight:'42px',display:'flex',justifyContent:'space-between'}}>\r\n              <Text style={{ fontSize: 26, fontWeight: \"bold\" }}>¬•{price}</Text>\r\n              <Button\r\n                style={{\r\n                  borderRadius: 21,\r\n                  width: 112,\r\n                  height: 42,\r\n                  fontSize:14,\r\n                  lineHeight: \"42px\",\r\n                  backgroundColor: \"#000\",\r\n                  display: \"inline-block\",\r\n                  color: \"#fff\",\r\n                  margin: 0,\r\n                }}\r\n                loading={payButtonLoading}\r\n                onTap={onPayTap}\r\n              >\r\n                Á´ãÂç≥Ë¥≠‰π∞\r\n              </Button>\r\n            </View>\r\n          </View>\r\n        );\r\n\r\n      default:\r\n        return <></>;\r\n    }\r\n  };\r\n\r\n  return renderPaymentStatusView();\r\n}\r\n","import { View, Text,Image ,ScrollView} from '@tarojs/components'\r\nimport {useRouter, useReady} from '@tarojs/taro'\r\nimport './index.less'\r\nimport playIcon from '@/assets/icons/playIcon.png'\r\nimport lockedIcon from '@/assets/icons/locked.png'\r\nimport { useEffect, useState } from 'react'\r\nimport Taro from '@tarojs/taro'\r\n\r\nexport default function Index ({curSessionId,classDesc,setCurSessionObj}) {\r\n  const {context,paymentStatus,learningSession} = classDesc\r\n  \r\n  useReady(() => {\r\n  })\r\n\r\n  useEffect(()=>{\r\n    \r\n  },[])\r\n\r\n  const handleSessionTap = (sessionId)=>{\r\n    const learningSessionObj = classDesc?.context?.find((i)=>(i.sessionId === sessionId))\r\n    setCurSessionObj(learningSessionObj)\r\n    Taro.setStorageSync('curLearningSession',sessionId)\r\n\r\n  }\r\n\r\n  return (\r\n        <View className='session-list'>\r\n          <View style={{marginBottom:7}}>ËØæÁ®ãÁõÆÂΩï</View>\r\n          <ScrollView\r\n            scrollY\r\n            style={{height:200}}\r\n          >\r\n            {context?.map(({chapterName,sessionId})=>(\r\n              paymentStatus=='notPaid'?\r\n              <View \r\n                style={{ height:40,fontSize: 12, marginBottom: 10 ,display:'flex',justifyContent:'space-between',backgroundColor:'#F9FAFB'}}\r\n              >\r\n                  <View style={{color:'#9CA3AF',lineHeight:'40px',marginLeft:10}}>\r\n                    <Image src={lockedIcon} style={{width:14, height:14,marginRight:7,verticalAlign:'middle'}}></Image>\r\n                    <Text style={{verticalAlign:'middle',width:300,display:'inline-block',overflow:'hidden',textOverflow:'ellipsis',wordBreak:'break-all',whiteSpace:'nowrap'}}>{chapterName}</Text>\r\n                  </View>\r\n              </View>:\r\n              <View \r\n                style={{ height:40,fontSize: 12, marginBottom: 10 ,display:'flex',justifyContent:'space-between',backgroundColor:sessionId==curSessionId?'#EFF6FF':'#F9FAFB'}}\r\n                onTap={()=>handleSessionTap(sessionId)}\r\n              >\r\n                  <View style={{color:sessionId==curSessionId?'#2563EB':'#4B5563',lineHeight:'40px',marginLeft:10}}>\r\n                    <Image src={playIcon} style={{width:14, height:14,marginRight:7,verticalAlign:'middle'}}></Image>\r\n                    <Text style={{verticalAlign:'middle',width:300,display:'inline-block',overflow:'hidden',textOverflow:'ellipsis',wordBreak:'break-all',whiteSpace:'nowrap'}}>{chapterName}</Text>\r\n                  </View>\r\n              </View>\r\n            ))}\r\n          </ScrollView>\r\n        </View>\r\n  )\r\n}\r\n","import { View, Text,Video } from '@tarojs/components'\r\nimport {useRouter, useReady, getStorageSync} from '@tarojs/taro'\r\nimport './index.less'\r\nimport { useEffect, useState ,useRef} from 'react'\r\nimport Taro from '@tarojs/taro'\r\nimport { log } from 'console'\r\n\r\nexport default function Index ({desc,curSessionObj,sessionId}) {\r\n  const videoRef = useRef<HTMLInputElement>(null)\r\n  \r\n  useReady(() => {\r\n  })\r\n\r\n  const handleProgressChange = (e)=>{\r\n    Taro.setStorageSync(sessionId+'',Math.floor(e.detail?.currentTime))\r\n    console.log(sessionId,getStorageSync(sessionId+''));\r\n    \r\n  }\r\n\r\n  // useEffect(()=>{\r\n  //   const videoContext = Taro.createVideoContext(sessionId+'',videoRef)\r\n  //   console.log('srcÂèòÂåñ‰∫Ü',curSessionObj,videoContext,videoRef.current);\r\n  //   // ËÆæÁΩÆ‰∏∫ÂÅúÊ≠¢Êí≠ÊîæÁä∂ÊÄÅ\r\n  //   videoContext.sendDanmu({text:'123'})\r\n  //   videoContext.stop()\r\n  // },[videoSrc])\r\n\r\n  return (\r\n        <Video \r\n          ref={videoRef}\r\n          id={sessionId+''}\r\n          style={{width:'100%',height:'100%'}}\r\n          autoplay={false}\r\n          // src={videoSrc}\r\n          src={`https://fsdyt-1258842400.cos.ap-chengdu.myqcloud.com/video/${desc.classId}/${sessionId}.mp4`}\r\n          initialTime={Taro.getStorageSync(sessionId+'')}\r\n          playBtnPosition='center'\r\n          signature='Ê∞¥Âç∞'\r\n          pageGesture\r\n          showPlayBtn\r\n          direction={90}\r\n          // showCenterPlayBtn\r\n          // showCastingButton\r\n          showScreenLockButton\r\n          showSnapshotButton\r\n          onTimeUpdate={(e)=>{handleProgressChange(e)}}\r\n        />\r\n  )\r\n}\r\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../../node_modules/.pnpm/@tarojs+taro-loader@4.0.7_webpack@5.91.0_@swc+core@1.3.96_/node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/Class/ClassDesc/index!./index.tsx\"\nvar config = {};\n\n\nvar inst = Page(createPageConfig(component, 'pages/Class/ClassDesc/index', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n","import apiClient from './apiClient'\r\nconst pay = (params)=>{\r\n  return apiClient.post(`api/create-wechat-pay-order`,params)\r\n}\r\n\r\nconst getPayRes = (orderId)=>{\r\n  return apiClient.get(`api/order-info/${orderId}`,{})\r\n}\r\nexport \r\n{\r\n  pay,getPayRes\r\n}"],"names":[],"sourceRoot":""}