{"version":3,"file":"pages/Class/ClassDesc/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;ACvIA;AACA;AACA;AAAA;AAGA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AACA;AAIA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;ACjDA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAGA;AAIA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;ACrDA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AAGA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;;;;;;;;;;;;;AChDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://YiClass/./src/pages/Class/ClassDesc/index.tsx?f223","webpack://YiClass/._src_pages_Class_ClassDesc_components_PaymentStatusBar_index.tsx","webpack://YiClass/._src_pages_Class_ClassDesc_components_SessionList_index.tsx","webpack://YiClass/._src_pages_Class_ClassDesc_components_VideoComp_index.tsx","webpack://YiClass/._src_pages_Class_ClassDesc_index.tsx"],"sourcesContent":["import { View, Text, Image } from \"@tarojs/components\";\nimport { useRouter, useReady, useUnload } from \"@tarojs/taro\";\nimport { getClassDescAPI, postSessionProgress } from \"@/services/class\";\nimport studentImg from \"@/assets/icons/student.png\";\nimport CustomVideo from \"./components/VideoComp\";\nimport SessionList from \"./components/SessionList\";\nimport PaymentStatusBar from \"./components/PaymentStatusBar\";\nimport defaultImg from \"@/assets/imgs/defaultImg.png\";\nimport \"./index.less\";\nimport { useEffect, useState } from \"react\";\nimport Taro from \"@tarojs/taro\";\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function Index() {\n  const {\n    params: urlParams\n  } = useRouter();\n  const {\n    classId\n  } = urlParams;\n  const [classDesc, setClassDesc] = useState({});\n  const [curSessionObj, setCurSessionObj] = useState({});\n  useReady(() => {\n    getClassDesc();\n  });\n  useUnload(() => {\n    // Âç∏ËΩΩÈ°µÈù¢Êó∂‰∏ä‰º†ÊâÄÊúâÁ´†ËäÇÁöÑËøõÂ∫¶ÔºåÁÑ∂ÂêéÊ∏ÖÈô§ÁºìÂ≠ò\n    const progressArr = classDesc?.context?.map(item => ({\n      sessionId: item.sessionId,\n      classId,\n      progress: Taro.getStorageSync(item.sessionId + '')\n    }));\n    postSessionProgress(progressArr);\n    console.log('ËßÜÈ¢ëÈ°µÈù¢Â∑≤ÁªèÂç∏ËΩΩÔºåÁºìÂ≠òÊòØÔºö', Taro.getStorageInfoSync());\n    Taro.clearStorageSync();\n    console.log('ËßÜÈ¢ëÈ°µÈù¢Â∑≤ÁªèÂç∏ËΩΩÔºåÊ∏ÖÈô§ÂêéÁºìÂ≠òÊòØÔºö', Taro.getStorageInfoSync());\n  });\n  const setProgressStorage = sessionList => {\n    console.log(\"üöÄ ~ setProgressStorage ~ sessionList:\", sessionList);\n    sessionList?.map(item => {\n      Taro.setStorageSync(item.sessionId + '', item.progress);\n    });\n  };\n  const getClassDesc = async () => {\n    try {\n      const response = await getClassDescAPI(classId || '');\n      const {\n        code,\n        data = {}\n      } = response.data;\n      // ÊääËßÜÈ¢ëËøõÂ∫¶ÊîæÂú®Êú¨Âú∞Â≠òÂÇ®\n      setProgressStorage(data.context || []);\n      setClassDesc(data);\n    } catch (error) {\n      Taro.showToast({\n        title: \"ËØ∑Ê±ÇÂ§±Ë¥•\",\n        icon: \"error\",\n        duration: 2000\n      });\n      console.log(\"Error sending chat message:\", error);\n    }\n  };\n  useEffect(() => {\n    const learningSessionObj = classDesc?.context?.find(i => i.sessionId == classDesc.learningSession) || {};\n    setCurSessionObj(learningSessionObj);\n  }, [classDesc.learningSession]);\n  return /*#__PURE__*/_jsxs(View, {\n    className: \"class-container\",\n    children: [/*#__PURE__*/_jsx(View, {\n      className: \"class-video-container\",\n      children: classDesc?.paymentStatus == 'notPaid' ? /*#__PURE__*/_jsx(Image, {\n        src: classDesc?.coverImage || defaultImg,\n        lazyLoad: true,\n        style: {\n          width: \"100%\",\n          height: \"100%\",\n          background: \"#fff\",\n          objectFit: \"contain\"\n        }\n      }) : /*#__PURE__*/_jsx(CustomVideo, {\n        desc: classDesc,\n        curSessionObj: curSessionObj,\n        sessionId: curSessionObj.sessionId || classDesc.learningSession\n      }, curSessionObj.sessionId)\n    }), /*#__PURE__*/_jsxs(View, {\n      className: \"class-desc-container\",\n      children: [/*#__PURE__*/_jsx(Text, {\n        className: \"class-name-text\",\n        children: classDesc?.className\n      }), /*#__PURE__*/_jsxs(View, {\n        style: {\n          fontSize: 12,\n          lineHeight: \"18px\",\n          color: \"#4B5563\",\n          marginTop: 6\n        },\n        children: [/*#__PURE__*/_jsx(Image, {\n          src: studentImg,\n          style: {\n            width: 14,\n            height: 14,\n            marginRight: 3,\n            verticalAlign: \"middle\"\n          }\n        }), /*#__PURE__*/_jsxs(Text, {\n          style: {\n            verticalAlign: \"middle\"\n          },\n          children: [classDesc?.studyNum, \"\\u4EBA\\u5B66\\u4E60\"]\n        })]\n      }), /*#__PURE__*/_jsxs(View, {\n        className: \"class-desc-text\",\n        children: [/*#__PURE__*/_jsx(Text, {\n          style: {\n            lineHeight: \"21px\",\n            color: \"#000\"\n          },\n          children: \"\\u8BFE\\u7A0B\\u7B80\\u4ECB\"\n        }), /*#__PURE__*/_jsx(View, {\n          style: {\n            marginTop: 6,\n            color: \"#4B5563\",\n            fontSize: 12,\n            lineHeight: \"19px\"\n          },\n          children: classDesc.description\n        })]\n      }), /*#__PURE__*/_jsx(SessionList, {\n        curSessionId: curSessionObj.sessionId,\n        classDesc: classDesc,\n        setCurSessionObj: setCurSessionObj\n      })]\n    }), /*#__PURE__*/_jsx(PaymentStatusBar, {\n      classDesc: classDesc\n    })]\n  });\n}","import { View, Button, Text } from \"@tarojs/components\";\nimport \"./index.less\";\nimport { useState } from \"react\";\nimport Taro from \"@tarojs/taro\";\n\nexport default function Index({ classDesc }) {\n  const { paymentStatus, price } = classDesc;\n  const [payButtonLoading, setPayButtonLoading] = useState<boolean>(false);\n\n  const onPayTap=()=>{\n    setPayButtonLoading(true)\n    // ! todo ÊîØ‰ªòÈÄªËæë\n  }\n\n  // Â∫ïÈÉ®ÊîØ‰ªòÁä∂ÊÄÅ‰ø°ÊÅØÁöÑÊ∏≤ÊüìÂáΩÊï∞\n  const renderPaymentStatusView = () => {\n    switch (paymentStatus) {\n      case \"notPaid\":\n        return (\n          <View className=\"bottom-info\">\n            <View style={{ margin: 15 ,height:42,lineHeight:'42px',display:'flex',justifyContent:'space-between'}}>\n              <Text style={{ fontSize: 26, fontWeight: \"bold\" }}>¬•{price}</Text>\n              <Button\n                style={{\n                  borderRadius: 21,\n                  width: 112,\n                  height: 42,\n                  fontSize:14,\n                  lineHeight: \"42px\",\n                  backgroundColor: \"#000\",\n                  display: \"inline-block\",\n                  color: \"#fff\",\n                  margin: 0,\n                }}\n                loading={payButtonLoading}\n                onTap={onPayTap}\n              >\n                Á´ãÂç≥Ë¥≠‰π∞\n              </Button>\n            </View>\n          </View>\n        );\n\n      default:\n        return <></>;\n    }\n  };\n\n  return renderPaymentStatusView();\n}\n","import { View, Text,Image ,ScrollView} from '@tarojs/components'\nimport {useRouter, useReady} from '@tarojs/taro'\nimport './index.less'\nimport playIcon from '@/assets/icons/playIcon.png'\nimport lockedIcon from '@/assets/icons/locked.png'\nimport { useEffect, useState } from 'react'\nimport Taro from '@tarojs/taro'\n\nexport default function Index ({curSessionId,classDesc,setCurSessionObj}) {\n  const {context,paymentStatus,learningSession} = classDesc\n  \n  useReady(() => {\n  })\n\n  useEffect(()=>{\n    \n  },[])\n\n  const handleSessionTap = (sessionId)=>{\n    const learningSessionObj = classDesc?.context?.find((i)=>(i.sessionId === sessionId))\n    setCurSessionObj(learningSessionObj)\n  }\n\n  return (\n        <View className='session-list'>\n          <View style={{marginBottom:7}}>ËØæÁ®ãÁõÆÂΩï</View>\n          <ScrollView\n            scrollY\n            style={{height:200}}\n          >\n            {context?.map(({chapterName,sessionId})=>(\n              paymentStatus=='notPaid'?\n              <View \n                style={{ height:40,fontSize: 12, marginBottom: 10 ,display:'flex',justifyContent:'space-between',backgroundColor:'#F9FAFB'}}\n              >\n                  <View style={{color:'#9CA3AF',lineHeight:'40px',marginLeft:10}}>\n                    <Image src={lockedIcon} style={{width:14, height:14,marginRight:7,verticalAlign:'middle'}}></Image>\n                    <Text style={{verticalAlign:'middle',width:300,display:'inline-block',overflow:'hidden',textOverflow:'ellipsis',wordBreak:'break-all',whiteSpace:'nowrap'}}>{chapterName}</Text>\n                  </View>\n              </View>:\n              <View \n                style={{ height:40,fontSize: 12, marginBottom: 10 ,display:'flex',justifyContent:'space-between',backgroundColor:sessionId==curSessionId?'#EFF6FF':'#F9FAFB'}}\n                onTap={()=>handleSessionTap(sessionId)}\n              >\n                  <View style={{color:sessionId==curSessionId?'#2563EB':'#4B5563',lineHeight:'40px',marginLeft:10}}>\n                    <Image src={playIcon} style={{width:14, height:14,marginRight:7,verticalAlign:'middle'}}></Image>\n                    <Text style={{verticalAlign:'middle',width:300,display:'inline-block',overflow:'hidden',textOverflow:'ellipsis',wordBreak:'break-all',whiteSpace:'nowrap'}}>{chapterName}</Text>\n                  </View>\n              </View>\n            ))}\n          </ScrollView>\n        </View>\n  )\n}\n","import { View, Text,Video } from '@tarojs/components'\nimport {useRouter, useReady, getStorageSync} from '@tarojs/taro'\nimport './index.less'\nimport { useEffect, useState ,useRef} from 'react'\nimport Taro from '@tarojs/taro'\nimport { log } from 'console'\n\nexport default function Index ({desc,curSessionObj,sessionId}) {\n  const {videoSrc,progress}=curSessionObj\n  const videoRef = useRef<HTMLInputElement>(null)\n  \n  useReady(() => {\n  })\n\n  const handleProgressChange = (e)=>{\n    Taro.setStorageSync(sessionId+'',Math.floor(e.detail?.currentTime))\n    console.log(sessionId,getStorageSync(sessionId+''));\n    \n  }\n\n  // useEffect(()=>{\n  //   const videoContext = Taro.createVideoContext(sessionId+'',videoRef)\n  //   console.log('srcÂèòÂåñ‰∫Ü',curSessionObj,videoContext,videoRef.current);\n  //   // ËÆæÁΩÆ‰∏∫ÂÅúÊ≠¢Êí≠ÊîæÁä∂ÊÄÅ\n  //   videoContext.sendDanmu({text:'123'})\n  //   videoContext.stop()\n  // },[videoSrc])\n\n  return (\n        <Video \n          ref={videoRef}\n          id={sessionId+''}\n          style={{width:'100%',height:'100%'}}\n          autoplay={false}\n          src={videoSrc}\n          // src={`https://fsdyt-1258842400.cos.ap-chengdu.myqcloud.com/${desc.classId}/${desc.classId}-${sessionId}.mp4`}\n          initialTime={Taro.getStorageSync(sessionId+'')}\n          playBtnPosition='center'\n          signature='Ê∞¥Âç∞'\n          pageGesture\n          showPlayBtn\n          // showCenterPlayBtn\n          // showCastingButton\n          showScreenLockButton\n          showSnapshotButton\n          onTimeUpdate={(e)=>{handleProgressChange(e)}}\n        />\n  )\n}\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../../node_modules/.pnpm/@tarojs+taro-loader@4.0.7_webpack@5.91.0_@swc+core@1.3.96_/node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/Class/ClassDesc/index!./index.tsx\"\nvar config = {};\n\n\nvar inst = Page(createPageConfig(component, 'pages/Class/ClassDesc/index', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n"],"names":[],"sourceRoot":""}